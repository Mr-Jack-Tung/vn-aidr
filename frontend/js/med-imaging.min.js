/*!
 * Open AI Doctor v0.0.1 (https://github.com/vietanhdev/ai-doctor)
 * Copyright 2020-2021 Viet Anh Nguyen
 * Licensed under MIT (https://github.com/StartBootstrap/open-ai-doctor/blob/master/LICENSE)
 */

"use strict";$(function(){var r;function s(){$(".loading-modal").hide()}function o(){(r=new Viewer(document.getElementById("viewer-images"),{inline:!0,navbar:!0,title:!0})).show()}$.get("ui-config.json",function(e){window.UI={};var i=window.UI;document.title=e.title,$(".sidebar-brand-text").html(e["sidebar-brand-text"]),$(".sidebar-brand-icon img").attr("src",e.logo);let t="";var a=e.sections;function l(){var e=$("#model-selector option:selected").val();window.currentModels[e].hide_sidebar?$("#prediction-sidebar").hide():$("#prediction-sidebar").show(),window.UI.api_endpoint=window.currentModels[e].api_endpoint}i.sections=a,$("#model-selector").change(function(){l()});for(let e=0;e<a.length;++e)t+='<li name="'+a[e].id+'" class="nav-item"><a class="nav-link" href="#"><i class="fas '+a[e].icon+'"></i><span>'+a[e].title+"</span></a></li>";$("#section-menu").html(t),$("#section-menu li").each(function(){$(this).click(function(){!function(t){$("#proba-chart-wrapper").hide(),$("#section-menu li").removeClass("active");for(let e=0;e<window.UI.sections.length;++e){var a=window.UI.sections[e];if(a.id==t){console.log("Select: "+t),$("#section-title").html(a.title),$('#section-menu li[name="'+t+'"]').addClass("active"),$("#output-log").val("");var n=a.models;window.currentModels={};let i="";for(let e=0;e<n.length;++e)i+="<option value='"+n[e].id+"' api_endpoint='"+n[e].api_endpoint+"'>"+n[e].title+"</option>",window.currentModels[n[e].id]=n[e];$("#model-selector").html(i),l(),$("#viewer-images").html('<ul><li><img src="'+a.img_placeholder+'" alt="VN AIDr"></li></ul>'),r&&r.destroy(),o();break}}}($(this).attr("name"))})}),$("#section-menu li").first().click()}),$("#upload-btn").click(function(){$("#upload-file").click()}),$("#upload-file").change(function(){$(".loading-modal").show();let i=new FormData;var t=$(this)[0].files;let e=$(this)[0].value;var a=0<=e.indexOf("\\")?e.lastIndexOf("\\"):e.lastIndexOf("/"),a=e.substring(a).replace("\\","");if(0<t.length){i.append("file",t[0]),i.append("filename",a),console.log("Sending request to: "+window.UI.api_endpoint),r&&r.destroy(),o();let e=new FileReader;e.onload=function(e){$("#viewer-images").html('<li><img src="'+e.target.result+'" alt="Original Image"></li>')},e.readAsDataURL(t[0]),$.ajax({url:window.UI.api_endpoint,type:"post",data:i,contentType:!1,processData:!1,success:function(e){s();var i=e.results;let t=[],a=[],n=[];e.prepend_original_image||$("#viewer-images").html("");for(let e=0;e<i.length;++e){var l,o=i[e];"probability"in o&&"label"in o&&(l=(100*o.probability).toFixed(1),t.push(o.label+": "+l+"%"),a.push(o.label),n.push(l)),"image"in o&&(l=$("#viewer-images").html(),$("#viewer-images").html(l+'<li><img src="'+o.image+'" alt="'+o.label+'"></li>'))}r.update(),r.moveTo(0,0),$("#output-log").val(t.join("\n")),window.probaChartData.labels=a,window.probaChartData.datasets[0].data=n,window.probaChart.update(),0<n.length?$("#proba-chart-wrapper").fadeIn():$("#proba-chart-wrapper").fadeOut(),$("#upload-file").val("")},error:function(){s(),$("#upload-file").val("")}})}else alert("Please select a file.")})});